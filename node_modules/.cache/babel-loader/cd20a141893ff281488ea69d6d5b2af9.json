{"ast":null,"code":"import agent from'./agent';import{ASYNC_START,ASYNC_END,LOGIN,LOGOUT,REGISTER}from'./constants/actionTypes';var promiseMiddleware=function promiseMiddleware(store){return function(next){return function(action){if(isPromise(action.payload)){store.dispatch({type:ASYNC_START,subtype:action.type});var currentView=store.getState().viewChangeCounter;var skipTracking=action.skipTracking;action.payload.then(function(res){var currentState=store.getState();if(!skipTracking&&currentState.viewChangeCounter!==currentView){return;}console.log('RESULT',res);action.payload=res;store.dispatch({type:ASYNC_END,promise:action.payload});store.dispatch(action);},function(error){var currentState=store.getState();if(!skipTracking&&currentState.viewChangeCounter!==currentView){return;}console.log('ERROR',error);action.error=true;action.payload=error.response.body;if(!action.skipTracking){store.dispatch({type:ASYNC_END,promise:action.payload});}store.dispatch(action);});return;}next(action);};};};var localStorageMiddleware=function localStorageMiddleware(store){return function(next){return function(action){if(action.type===REGISTER||action.type===LOGIN){if(!action.error){window.localStorage.setItem('jwt',action.payload.user.token);agent.setToken(action.payload.user.token);}}else if(action.type===LOGOUT){window.localStorage.setItem('jwt','');agent.setToken(null);}next(action);};};};function isPromise(v){return v&&typeof v.then==='function';}export{promiseMiddleware,localStorageMiddleware};","map":{"version":3,"sources":["/storage/emulated/0/ASTRO/projects/react_2/src/middleware.js"],"names":["agent","ASYNC_START","ASYNC_END","LOGIN","LOGOUT","REGISTER","promiseMiddleware","store","next","action","isPromise","payload","dispatch","type","subtype","currentView","getState","viewChangeCounter","skipTracking","then","res","currentState","console","log","promise","error","response","body","localStorageMiddleware","window","localStorage","setItem","user","token","setToken","v"],"mappings":"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","sourcesContent":["import agent from './agent';\nimport {\n  ASYNC_START,\n  ASYNC_END,\n  LOGIN,\n  LOGOUT,\n  REGISTER\n} from './constants/actionTypes';\n\nconst promiseMiddleware = store => next => action => {\n  if (isPromise(action.payload)) {\n    store.dispatch({ type: ASYNC_START, subtype: action.type });\n\n    const currentView = store.getState().viewChangeCounter;\n    const skipTracking = action.skipTracking;\n\n    action.payload.then(\n      res => {\n        const currentState = store.getState()\n        if (!skipTracking && currentState.viewChangeCounter !== currentView) {\n          return\n        }\n        console.log('RESULT', res);\n        action.payload = res;\n        store.dispatch({ type: ASYNC_END, promise: action.payload });\n        store.dispatch(action);\n      },\n      error => {\n        const currentState = store.getState()\n        if (!skipTracking && currentState.viewChangeCounter !== currentView) {\n          return\n        }\n        console.log('ERROR', error);\n        action.error = true;\n        action.payload = error.response.body;\n        if (!action.skipTracking) {\n          store.dispatch({ type: ASYNC_END, promise: action.payload });\n        }\n        store.dispatch(action);\n      }\n    );\n\n    return;\n  }\n\n  next(action);\n};\n\nconst localStorageMiddleware = store => next => action => {\n  if (action.type === REGISTER || action.type === LOGIN) {\n    if (!action.error) {\n      window.localStorage.setItem('jwt', action.payload.user.token);\n      agent.setToken(action.payload.user.token);\n    }\n  } else if (action.type === LOGOUT) {\n    window.localStorage.setItem('jwt', '');\n    agent.setToken(null);\n  }\n\n  next(action);\n};\n\nfunction isPromise(v) {\n  return v && typeof v.then === 'function';\n}\n\n\nexport { promiseMiddleware, localStorageMiddleware }\n"]},"metadata":{},"sourceType":"module"}